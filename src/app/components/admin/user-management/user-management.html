<div class="user-management">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h4>Quản lý tài khoản</h4>
      <div class="d-flex">
        <input type="text" class="form-control me-2" placeholder="Tìm kiếm..." [(ngModel)]="searchTerm" (input)="filterUsers()">
        <select class="form-select me-2" [(ngModel)]="roleFilter" (change)="filterUsers()">
          <option value="">Tất cả vai trò</option>
          <option value="Admin">Admin</option>
          <option value="User">Tình nguyện viên</option>
          <option value="Organization">Tổ chức</option>
        </select>
        <select class="form-select" [(ngModel)]="statusFilter" (change)="filterUsers()">
          <option value="">Tất cả trạng thái</option>
          <option value="true">Đang hoạt động</option>
          <option value="false">Đã khóa</option>
        </select>
      </div>
    </div>
    
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>ID</th>
              <th>Họ tên</th>
              <th>Email</th>
              <th>Vai trò</th>
              <th>Trạng thái</th>
              <th>Ngày tạo</th>
              <th>Thao tác</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of filteredUsers">
              <td>{{user.maTaiKhoan}}</td>
              <td>{{user.hoTen || 'Chưa cập nhật'}}</td>
              <td>{{user.email}}</td>
              <td>
                <span class="badge rounded-pill" [ngClass]="{
                  'bg-primary': user.vaiTro === 'Admin',
                  'bg-success': user.vaiTro === 'User',
                  'bg-info': user.vaiTro === 'Organization'
                }">{{user.vaiTro}}</span>
              </td>
              <td>
                <span class="badge rounded-pill" [ngClass]="{
                  'bg-success': user.trangThai,
                  'bg-danger': !user.trangThai
                }">{{user.trangThai ? 'Hoạt động' : 'Đã khóa'}}</span>
              </td>
              <td>{{user.ngayTao | date:'dd/MM/yyyy HH:mm'}}</td>
              <td>
                <div class="btn-group" role="group">
                  <button class="btn btn-sm btn-outline-primary" (click)="openRoleModal(user)">
                    <i class="bi bi-person-gear"></i> Vai trò
                  </button>
                  <button class="btn btn-sm" [ngClass]="{'btn-outline-danger': user.trangThai, 'btn-outline-success': !user.trangThai}" (click)="toggleUserStatus(user)">
                    <i class="bi" [ngClass]="{'bi-lock-fill': user.trangThai, 'bi-unlock-fill': !user.trangThai}"></i>
                    {{user.trangThai ? 'Khóa' : 'Mở khóa'}}
                  </button>
                  <button class="btn btn-sm btn-outline-danger" (click)="confirmDeleteUser(user)">
                    <i class="bi bi-trash"></i> Xóa
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="filteredUsers.length === 0">
              <td colspan="7" class="text-center">Không có dữ liệu</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal đổi vai trò -->
<div class="modal fade" id="roleModal" tabindex="-1" aria-labelledby="roleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="roleModalLabel">Thay đổi vai trò</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" *ngIf="selectedUser">
        <p>Tài khoản: <strong>{{selectedUser.email}}</strong></p>
        <p>Vai trò hiện tại: <strong>{{selectedUser.vaiTro}}</strong></p>
        <div class="mb-3">
          <label for="newRole" class="form-label">Vai trò mới:</label>
          <select id="newRole" class="form-select" [(ngModel)]="newRole">
            <option value="Admin">Admin</option>
            <option value="User">Tình nguyện viên</option>
            <option value="Organization">Tổ chức</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
        <button type="button" class="btn btn-primary" (click)="updateUserRole()">Lưu thay đổi</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal xác nhận xóa -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">Xác nhận xóa</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" *ngIf="selectedUser">
        <p>Bạn có chắc chắn muốn xóa tài khoản này?</p>
        <p><strong>Email:</strong> {{selectedUser.email}}</p>
        <p><strong>Vai trò:</strong> {{selectedUser.vaiTro}}</p>
        <div class="alert alert-danger">
          Lưu ý: Hành động này không thể hoàn tác!
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
        <button type="button" class="btn btn-danger" (click)="deleteUser()">Xóa</button>
      </div>
    </div>
  </div>
</div>