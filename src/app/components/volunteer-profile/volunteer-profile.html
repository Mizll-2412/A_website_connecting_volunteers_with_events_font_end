<div class="container my-4">
  <div class="row g-4">
    <!-- Sidebar -->
    <aside class="col-lg-3">
      <div class="card border-0 shadow-sm p-3">
        <div class="list-group">
          <button class="list-group-item list-group-item-action"
                  [class.active]="selectedMenuItem === 'profile'"
                  (click)="selectMenuItem('profile')">
            Hồ sơ cá nhân
          </button>
          <button class="list-group-item list-group-item-action"
                  [class.active]="selectedMenuItem === 'family'"
                  (click)="selectMenuItem('family')">
            Sự kiện đã tham gia
          </button>
          <button class="list-group-item list-group-item-action"
                  [class.active]="selectedMenuItem === 'certificates'"
                  (click)="selectMenuItem('certificates')">
            Giấy chứng nhận
          </button>
          <button class="list-group-item list-group-item-action"
                  [class.active]="selectedMenuItem === 'ratings'"
                  (click)="selectMenuItem('ratings')">
            Đánh giá & điểm uy tín
          </button>
        </div>
      </div>
    </aside>

    <!-- Content -->
    <main class="col-lg-9">
      <div class="card border-0 shadow-sm p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h4 class="fw-semibold mb-0">Thông tin cá nhân</h4>
          <button class="btn btn-success" (click)="onSubmit()">
            {{ volunteer?.maTNV ? 'Cập nhật hồ sơ' : 'Tạo hồ sơ' }}
          </button>
        </div>

        <form [formGroup]="registrationForm">
          <div class="row g-4">
            <!-- Avatar -->
            <div class="col-md-4 text-center">
              <div class="position-relative">
                <input type="file" id="avatar" accept="image/*" (change)="onFileSelected($event)" hidden />
                <label for="avatar" class="d-inline-block border border-2 border-success rounded-circle overflow-hidden" style="width: 150px; height: 150px; cursor: pointer;">
                  <img *ngIf="previewUrl" [src]="previewUrl" alt="Avatar" class="w-100 h-100 object-fit-cover" />
                  <span *ngIf="!previewUrl" class="display-5 text-secondary d-flex align-items-center justify-content-center h-100">+</span>
                </label>
              </div>
              <p class="mt-2 small text-muted">Điểm đánh giá: {{ volunteer?.diemTrungBinh || 0 }}</p>
            </div>

            <!-- Form Fields -->
            <div class="col-md-8">
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">Họ Tên</label>
                  <input type="text" formControlName="hoTen" class="form-control" placeholder="Nhập họ tên" />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Email</label>
                  <input type="email" formControlName="email" class="form-control" placeholder="Nhập email" />
                </div>
                <div class="col-md-6">
                  <label class="form-label">CCCD</label>
                  <input type="text" formControlName="cccd" class="form-control" placeholder="Nhập CCCD" />
                </div>
                <div class="col-md-6">
                  <label class="form-label">SĐT</label>
                  <input type="tel" formControlName="soDienThoai" class="form-control" placeholder="Nhập số điện thoại" />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Ngày sinh</label>
                  <input type="date" formControlName="ngaySinh" class="form-control" />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Giới tính</label>
                  <select formControlName="gioiTinh" class="form-select">
                    <option value="">-- Chọn giới tính --</option>
                    <option value="Nam">Nam</option>
                    <option value="Nữ">Nữ</option>
                    <option value="Khác">Khác</option>
                  </select>
                </div>

                <div class="col-12">
                  <label class="form-label">Địa chỉ</label>
                  <input type="text" formControlName="diaChi" class="form-control" placeholder="Nhập địa chỉ" />
                </div>
                <div class="col-12">
                  <label class="form-label">Giới thiệu bản thân</label>
                  <textarea formControlName="gioiThieu" class="form-control" rows="3" placeholder="Giới thiệu về bản thân..."></textarea>
                </div>

                <!-- Kỹ năng -->
                <div class="col-12">
                  <label class="form-label">Kỹ năng</label>
                  <div class="row g-2">
                    <div class="col-md-6" *ngFor="let knIdx of [0,1,2,3]">
                      <select class="form-select" (change)="onKyNangChange(knIdx, $event)" [ngModel]="selectedKyNangs[knIdx]" [ngModelOptions]="{standalone: true}">
                        <option value="">-- Chọn kỹ năng {{knIdx + 1}} --</option>
                        <option *ngFor="let kn of getAvailableKyNangs(knIdx)" [value]="kn.maKyNang">{{ kn.tenKyNang }}</option>
                      </select>
                    </div>
                  </div>
                </div>

                <!-- Lĩnh vực -->
                <div class="col-12">
                  <label class="form-label">Lĩnh vực quan tâm</label>
                  <div class="row g-2">
                    <div class="col-md-6" *ngFor="let lvIdx of [0,1,2,3]">
                      <select class="form-select" (change)="onLinhVucChange(lvIdx, $event)" [ngModel]="selectedLinhVucs[lvIdx]" [ngModelOptions]="{standalone: true}">
                        <option value="">-- Chọn lĩnh vực {{lvIdx + 1}} --</option>
                        <option *ngFor="let lv of getAvailableLinhVucs(lvIdx)" [value]="lv.maLinhVuc">{{ lv.tenLinhVuc }}</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </main>
  </div>
</div>
